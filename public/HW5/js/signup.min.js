const txtEmail=document.getElementById('email');const txtPassword=document.getElementById('password');const profilePic=document.getElementById('image-file').files[0];const btnUploadImage=document.getElementById('upload-image-btn');const btnSubmit=document.getElementById('submit');const btnGoogle=document.getElementById('google');(function(){btnUploadImage.addEventListener('click',e=>{document.getElementById('image-file').click()});btnSubmit.addEventListener('click',e=>{e.preventDefault();const email=txtEmail.value;const password=txtPassword.value;const profilePic=document.getElementById('image-file').files[0];const auth=firebase.auth();var promise=auth.createUserWithEmailAndPassword(email,password);promise.catch(validateForm);promise.then(function(){if(profilePic){var filename=auth.currentUser.uid+'.'+profilePic.name.split('.').pop();var storageRef=firebase.storage().ref().child('Users/'+filename);var uploadTask=storageRef.put(profilePic);uploadTask.on('state_changed',function(snapshot){},function(error){console.log("Error during profile pic upload.");console.log(error)},function(){var photoURL=uploadTask.snapshot.downloadURL;var promise=firebase.database().ref('Users/'+auth.currentUser.uid).set({Profile:{picture:photoURL}});promise.then(function(){window.location="./community.html"})})}
else{var filename='Users/profile.png';firebase.storage().ref().child(filename).getDownloadURL().then(function(url){var promise=firebase.database().ref('Users/'+auth.currentUser.uid).set({Profile:{picture:url}});promise.then(function(){window.location="./community.html"})})}})});btnGoogle.addEventListener('click',e=>{e.preventDefault();var provider=new firebase.auth.GoogleAuthProvider();const auth=firebase.auth();const promise=auth.signInWithPopup(provider);promise.catch(e=>console.log(e.message));promise.then(function(){var photoURL;if(auth.currentUser.photoURL){photoURL=auth.currentUser.photoURL}
else{photoURL=firebase.storage().ref().child('Users/profile.png').getDownloadURL()}
var promise=firebase.database().ref('Users/'+auth.currentUser.uid).set({Profile:{picture:photoURL}});promise.then(function(){window.location="./community.html"})})});firebase.auth().onAuthStateChanged(firebaseUser=>{if(firebaseUser){console.log(firebaseUser)}
else{console.log("not logged in")}})}());function previewFile(){var preview=document.querySelector('#profile-pic');var file=document.querySelector('#image-file').files[0];var reader=new FileReader();reader.onloadend=function(){preview.src=reader.result}
if(file){reader.readAsDataURL(file)}
else{preview.src=""}}
function validateForm(error){txtEmail.style.border='';txtPassword.style.border='';txtEmail.value='';txtPassword.value='';txtEmail.placeholder='';txtPassword.placeholder='';switch(error.code){case 'auth/invalid-email':txtEmail.style.border='3px solid #FF6138';txtEmail.placeholder='Invalid Email';break;case 'auth/weak-password':txtPassword.style.border='3px solid #FF6138';txtPassword.placeholder='Weak Password';break;case 'auth/email-already-in-use':txtEmail.style.border='3px solid #FF6138';txtEmail.placeholder='Email Already Exists';break}}
